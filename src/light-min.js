(function(h,f){var k=h,j=k.document,c=f;GLOBAL_CONFIG={horizontal:50,vertical:50,gap:0,ceilLength:9,trailNum:40,trailAlpha:0.3,blurRange:18,lightVelocity:[2,4],interval:10,delay:[500,900],color:["#5D655B","#3C433D","#212722","#2F362F"],lightDirection:["up","down","left","right"],lightColor:["#ff0000","#FFEE00","#00A8FF","#00ff00"]};var m=(function(){var s=j.createElement("canvas"),o=j.createElement("canvas"),n=s.getContext("2d"),t=o.getContext("2d"),r=GLOBAL_CONFIG;function d(){var x=r.horizontal,w=r.vertical,u=r.ceilLength,y=r.gap;j.body.appendChild(s);j.body.appendChild(o);s.style.position=o.style.position="absolute";s.style.left=o.style.left="0px";s.style.background="#333";s.style.top=o.style.top="0px";s.width=o.width=(u+y)*x;s.height=o.height=(u+y)*w}function p(){o.addEventListener("mousedown",e.handler,false)}function q(){d();a.init(n);e.init(t);p()}return{init:q}})();var a=(function(){var d=null;function n(q,t){var s=GLOBAL_CONFIG.color,r=GLOBAL_CONFIG.ceilLength;d.moveTo(q,t);d.fillStyle=s[0];d.beginPath();d.lineTo(q+r,t);d.lineTo(q+r/2,t+r/2);d.lineTo(q,t);d.closePath();d.fill();d.fillStyle=s[1];d.beginPath();d.lineTo(q,t+r);d.lineTo(q+r/2,t+r/2);d.lineTo(q,t);d.closePath();d.fill();d.fillStyle=s[2];d.beginPath();d.moveTo(q,t+r);d.lineTo(q+r,t+r);d.lineTo(q+r/2,t+r/2);d.lineTo(q,t+r);d.closePath();d.fill();d.fillStyle=s[3];d.beginPath();d.moveTo(q+r,t+r);d.lineTo(q+r/2,t+r/2);d.lineTo(q+r,t);d.lineTo(q+r,t+r);d.closePath();d.fill()}function o(){var x=GLOBAL_CONFIG,u=x.horizontal,r=x.vertical,q=x.ceilLength,w=x.gap;for(var t=0;t<u;t++){for(var s=0;s<r;s++){n((t*(w+q)),s*(w+q))}}}function p(q){d=q;o()}return{init:p}})();var i=(function(){function o(q){var q=q.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/).slice(1);return q.map(function(r){return(parseInt(r,16)).toString(10)}).join()}function n(r){var q=Math.ceil(Math.random()*r.length)-1;return r[q]}function p(s){if(s instanceof Array){var r=s[0],q=s[1];return r+Math.ceil(Math.random()*(q-r))-1}return s}function d(q){return q.sort(function(){return Math.random()>0.5?1:-1})}return{hexToRgb:o,randomArr:n,randomRange:p,ranArr:d}})();var e=(function(){var z=null,s=null,y=[],x=GLOBAL_CONFIG,F=x.horizontal,t=x.vertical,A=i.randomArr,w=i.randomRange,J=i.ranArr,q={up:{x:[0,F],y:t},down:{x:[0,F],y:0},left:{x:F,y:[0,t]},right:{x:0,y:[0,t]}};function D(v){z=v;o()}function H(v){if(v.x<-450||v.x>900||v.y<-450||v.y>900){return false}return true}function n(){var M=w(x.lightVelocity),L=A(x.lightDirection),K=A(x.lightColor),v=w(q[L].x)*x.ceilLength,N=w(q[L].y)*x.ceilLength;var C=new b();C.init(M,L,K);C.generate(v,N);y.push(C)}function r(K){var v=K.clientX,L=K.clientY,C=x.ceilLength;v-=(v%C);L-=(L%C);B(v,L)}function o(){if(!s){I()}G()}function G(){var v=w(x.delay),C=setTimeout(function(){n();G()},v)}function I(){s=setInterval(function(){z.clearRect(0,0,1000,1000);y.forEach(function(v){p(v)})},x.interval)}function d(v){r(v)}function B(v,C){J(x.lightColor);["up","down","left","right"].forEach(function(L,M){var K=new b();color=x.lightColor[M];K.init(3,L,color);K.generate(v,C);y.push(K)})}function p(v){v.light.x+=v.vector.unitX*v.velocity;v.light.y+=v.vector.unitY*v.velocity;v.update();v.draw(z);u()}function u(){y.forEach(function(C,v){var K=C.trail[C.trail.length-1];if(!H(K)){y.splice(v,1)}})}function E(v){v.destroy();v=null;delete v}return{init:D,handler:d}})();function g(d){this.x=0;this.y=0;this.alpha=1;this.length=GLOBAL_CONFIG.ceilLength;this.color=d}g.prototype={constructor:g,draw:function(d){d.shadowBlur=0;d.shadowColor="transparent";if(this.head){d.shadowBlur=GLOBAL_CONFIG.blurRange;d.shadowColor=this.color}d.fillStyle="rgba("+i.hexToRgb(this.color)+","+this.alpha+")";d.fillRect(this.x,this.y,this.length,this.length)},destroy:function(){}};function b(){this.trail=[]}b.prototype={constructor:b,init:function(n,o,d){this.velocity=n;this.direction=o;this.color=d;this.light=new g(this.color);this.light.head=true;this.light.alpha=0.4;this.vector={unitX:(o=="right"?1:o=="left"?-1:0),unitY:(o=="up"?-1:o=="down"?1:0)};this.addTrail()},addTrail:function(){var p=GLOBAL_CONFIG;for(var o=0,q=p.trailNum;o<q;o++){var d=new g(this.color);d.alpha=parseFloat(p.trailAlpha*(q-o)/(q+1));this.trail[o]=d}},generate:function(d,n){this.light.x=d;this.light.y=n},update:function(){for(var n=0,d=this.trail.length;n<d;n++){this.trail[n].x=this.light.x-n*this.light.length*this.vector.unitX;this.trail[n].y=this.light.y-n*this.light.length*this.vector.unitY}},draw:function(d){this.light.draw(d);this.trail.forEach(function(o,n){o.draw(d)})},destroy:function(){this.light=null;delete this.light;this.trail=null;delete this.trail}};function l(){var d=j.createElement("canvas");return !!(d.getContext&&d.getContext("2d"))}window.onload=function(){m.init()}})(window);